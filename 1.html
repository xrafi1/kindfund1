<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Online: T vs R</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        body { background-color: #0d0d26; color: white; font-family: 'Arial', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        
        /* Lobby Styles */
        #lobby { text-align: center; }
        input { padding: 10px; font-size: 1.2rem; border-radius: 5px; border: none; margin-bottom: 10px; width: 200px; text-align: center;}
        button { padding: 10px 20px; font-size: 1.2rem; cursor: pointer; background: #00d2ff; border: none; border-radius: 5px; color: #000; font-weight: bold; transition: 0.3s; margin: 5px;}
        button:hover { box-shadow: 0 0 15px #00d2ff; }
        button.red { background: #ff0055; color: white; }
        button.red:hover { box-shadow: 0 0 15px #ff0055; }

        /* Game Styles */
        #gameArea { display: none; text-align: center; }
        .title { font-size: 2.5rem; text-shadow: 0 0 10px #fff; letter-spacing: 2px; margin-bottom: 10px;}
        .status { font-size: 1.5rem; margin-bottom: 20px; color: #ccc; }
        .room-info { font-size: 0.9rem; margin-bottom: 10px; color: #666; }

        .game-board {
            display: grid; grid-template-columns: repeat(3, 100px); grid-template-rows: repeat(3, 100px); gap: 5px; margin: 0 auto;
        }

        .cell {
            background-color: #120c34; border: 2px solid #00d2ff; box-shadow: 0 0 5px #00d2ff;
            display: flex; justify-content: center; align-items: center;
            font-size: 4rem; font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .cell:hover { background-color: #1f164d; }

        /* Neon Effects */
        .cell.T { color: #00d2ff; text-shadow: 0 0 15px #00d2ff, 0 0 30px #00d2ff; pointer-events: none;}
        .cell.R { color: #ff0055; text-shadow: 0 0 15px #ff0055, 0 0 30px #ff0055; pointer-events: none;}
    </style>
</head>
<body>

    <div id="lobby">
        <h1 class="title">NEON BATTLE ONLINE</h1>
        <p>Enter a Room Name to Join or Create</p>
        <input type="text" id="roomName" placeholder="e.g. room1">
        <br>
        <button onclick="joinGame('T')">Join as Player T (Blue)</button>
        <button class="red" onclick="joinGame('R')">Join as Player R (Red)</button>
    </div>

    <div id="gameArea">
        <h1 class="title">NEON BATTLE</h1>
        <div class="room-info">Room: <span id="displayRoom"></span> | You are: <span id="displayPlayer"></span></div>
        <div class="status" id="status">Waiting for opponent...</div>
        
        <div class="game-board">
            <div class="cell" onclick="makeMove(0)" id="c0"></div>
            <div class="cell" onclick="makeMove(1)" id="c1"></div>
            <div class="cell" onclick="makeMove(2)" id="c2"></div>
            <div class="cell" onclick="makeMove(3)" id="c3"></div>
            <div class="cell" onclick="makeMove(4)" id="c4"></div>
            <div class="cell" onclick="makeMove(5)" id="c5"></div>
            <div class="cell" onclick="makeMove(6)" id="c6"></div>
            <div class="cell" onclick="makeMove(7)" id="c7"></div>
            <div class="cell" onclick="makeMove(8)" id="c8"></div>
        </div>
        <button onclick="resetGame()" style="margin-top:20px;">Reset Board</button>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        // TODO: PASTE YOUR FIREBASE CONFIG HERE 
        const firebaseConfig = {
            apiKey: "AIzaSy...",
            authDomain: "your-project.firebaseapp.com",
            databaseURL: "https://your-project-default-rtdb.firebaseio.com",
            projectId: "your-project",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123...",
            appId: "1:123..."
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // --- 2. GAME VARIABLES ---
        let myPlayer = ''; // 'T' or 'R'
        let currentRoom = '';
        let boardState = ["", "", "", "", "", "", "", "", ""];
        let currentPlayer = 'T'; // T always starts
        let gameActive = true;

        const winningConditions = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];

        // --- 3. LOBBY LOGIC ---
        function joinGame(player) {
            const roomInput = document.getElementById('roomName').value;
            if (!roomInput) return alert("Please enter a room name!");

            myPlayer = player;
            currentRoom = roomInput;

            document.getElementById('lobby').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('displayRoom').innerText = currentRoom;
            document.getElementById('displayPlayer').innerText = myPlayer;

            // Listen for updates from the database
            const roomRef = db.ref('rooms/' + currentRoom);
            roomRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    updateBoard(data.board, data.turn);
                } else {
                    // New room, initialize it
                    resetGame(); 
                }
            });
        }

        // --- 4. GAMEPLAY LOGIC ---
        function makeMove(index) {
            if (!gameActive || boardState[index] !== "" || currentPlayer !== myPlayer) {
                return; // Illegal move or not your turn
            }

            // Update local state temporarily
            boardState[index] = myPlayer;
            const nextTurn = myPlayer === 'T' ? 'R' : 'T';

            // Send to Database
            db.ref('rooms/' + currentRoom).set({
                board: boardState,
                turn: nextTurn
            });
        }

        function updateBoard(serverBoard, serverTurn) {
            if (!serverBoard) return;
            
            boardState = serverBoard;
            currentPlayer = serverTurn;
            
            // Update UI
            for (let i = 0; i < 9; i++) {
                const cell = document.getElementById('c' + i);
                cell.innerText = boardState[i];
                cell.className = 'cell'; // Reset classes
                if (boardState[i] === 'T') cell.classList.add('T');
                if (boardState[i] === 'R') cell.classList.add('R');
            }

            checkResult();
            
            if (gameActive) {
                const statusText = document.getElementById('status');
                if (currentPlayer === myPlayer) {
                    statusText.innerText = "It's YOUR Turn!";
                    statusText.style.color = "#00ff00";
                } else {
                    statusText.innerText = `Waiting for Player ${currentPlayer}...`;
                    statusText.style.color = "#ccc";
                }
            }
        }

        function checkResult() {
            let roundWon = false;
            for (let i = 0; i < winningConditions.length; i++) {
                const [a, b, c] = winningConditions[i];
                if (boardState[a] && boardState[a] === boardState[b] && boardState[a] === boardState[c]) {
                    roundWon = true;
                    break;
                }
            }

            if (roundWon) {
                const winner = currentPlayer === 'T' ? 'R' : 'T'; // Previous player won
                document.getElementById('status').innerText = `Player ${winner} Wins!`;
                gameActive = false;
                return;
            }

            if (!boardState.includes("")) {
                document.getElementById('status').innerText = "Draw!";
                gameActive = false;
            } else {
                gameActive = true;
            }
        }

        function resetGame() {
            db.ref('rooms/' + currentRoom).set({
                board: ["", "", "", "", "", "", "", "", ""],
                turn: "T"
            });
        }
    </script>
</body>
</html>
